# Automação de views - Regra de Negócio

**Nome do Estagiário:** Melina Nogueira

**Squad:** Git Force

**Data:** 20/09/2024

---
## **Index**
1. **[Tarefa](#tarefa)**
2. **[O que foi feito](#o-que-foi-feito)**

    2.1. [Dia 17/09](#1709)

    2.2. [Dia 18/09](#1809)

    2.3. [Dia 19/09](#1909)

    2.4. [Dia 20/09](#2009)

3. **[Resultado](#resultado)**
4. **[Dúvidas](#dúvidas)**
---
## **Tarefa** 
**Gerar modelo com GenAi para criação automatizada de views a partir de uma regra de negócio.**

**Task - Gerar tabela**
- Criar um dataset no BigQuery;
- Criar uma tabela e definir seus campos
- Preencher com dados mocados

---

## **O que foi feito**

### **17/09**
- Reunião: definição de tarefa e tirar dúvidas;
- Criação do fluxo de tarefa e alinhamento com a outra squad.

### **18/09**
- Criação e atribuição das tasks e organização da sprint;
- Estudo sobre funcionamento dos modelos de GenAI com o dataset e suas tabelas.

### **19/09**
- Foi criado uma tabela aleatória apenas para treinamento, pois não ainda não tinha sido enviado o esquema que deveremos utilizar;
- Criação do dataset `rules_table` para armazenar as tabelas;
- Criação da tabela `rules_to_views`;
```SQL
CREATE TABLE `tarefa-squad.rules_table.rules_to_views` (
  rule_id STRING NOT NULL,
  business_rule STRING NOT NULL,
  view_sql STRING,
  created_at TIMESTAMP NOT NULL
)
```

- Inserir dados na tabela;
```SQL
INSERT INTO `tarefa-squad.rules_table.rules_to_views` 
(rule_id, business_rule, view_sql, created_at)
VALUES
("rule_001", "Agrupar compras por cliente e calcular o total gasto", 
"CREATE VIEW v_compras_clientes AS SELECT client_id, SUM(price * amount) AS total_spent FROM purchases GROUP BY client_id;", 
CURRENT_TIMESTAMP()),

("rule_002", "Agrupar produtos e calcular a média de preço", 
"CREATE VIEW v_produtos_media_preco AS SELECT product_id, AVG(price) AS preco_medio FROM purchases GROUP BY product_id;", 
CURRENT_TIMESTAMP()),

("rule_003", "Contar o número de compras por localização", 
"CREATE VIEW v_compras_por_localizacao AS SELECT purchase_location, COUNT(*) AS total_compras FROM purchases GROUP BY purchase_location;", 
CURRENT_TIMESTAMP()),

("rule_004", "Mostrar o total de vendas por produto nos últimos 3 meses, agrupado por categoria.", 
"CREATE VIEW vendas_por_produto_3meses AS SELECT p.categoria, p.produto, SUM(v.valor) AS total_vendas FROM produtos p INNER JOIN vendas v ON p.id = v.produto_id WHERE v.data >= DATE_SUB(CURDATE(), INTERVAL 3 MONTH) GROUP BY p.categoria, p.produto;", 
CURRENT_TIMESTAMP());
```

- Visualização da tabela.
![Tabela rules_to_view](image\tabela_rules.png)

- Criei o dataset `pfs_unificacao_pefisa`

### **20/09**

---

## **Resultado**
- 

## **Dúvidas**
- 